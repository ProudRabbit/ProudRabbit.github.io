---
title: 串口输出中文乱码
date: 2020-07-29 15:38:56
tags: [随笔,BUG]
keywords:
description: 记录下自己遇到的串口输出一直乱码的问题。
---

# 串口输出中文乱码  

## 问题产生

最近在使用`OpenMV`，但是由于没有转接板和软排线来连接串口，不过手上有一块`STM32F4`的开发板，于是就想到将其作为一个转接，通过其接收`OpenMV`发送的数据，并将其转发到电脑上，结果串口助手一直输出乱码。  

<!--more-->  

## 寻找问题产生的原因

一开始以为是自己波特率设置的有问题，但是查验后并不是，`PC`，`OpenMV`，`STM32`之间设置的波特率都是对应的。然后又以为是自己改过`STM32F4`的时钟频率，然后开始查`STM32`时钟频率的设置，发现也没问题。怎么也找不到问题在哪。/(ㄒoㄒ)/~~

后来突然想到`OpenMV`是使用`MicorPython`语言写的，一般的字符编码为`UTF-8`，而`STM32`用的是`keil`的IDE开发的，编码格式一般为`ASNII`，两个字符编码不一样也会导致乱码，于是将其都改为`UTF-8`编码，结果乱码依旧。。。 (╯‵□′)╯︵┻━┻

为了继续查找问题所在，先是将`OpenMV`发送给`STM32`数据直接返回`OpenMV`结果正确，然后将串口助手发送给`STM32`的数据直接返回，结果正确。由此可以看出，串口助手和`OpenMV`的字符编码不一致导致的乱码。这里给出一个网址，可以在线转换乱码。[乱码恢复](http://www.mytju.com/classCode/tools/messyCodeRecover.asp) 。从中我们可以看到，前后的编码不一致。

![image-20200729163715363](https://i.loli.net/2020/07/29/i1PsQfEOqGkrheC.png)

**至此，找到了问题所在，串口助手不支持`UTF-8`编码。**(￣_￣|||)  



## 解决问题  

既然串口助手不支持，那就找支持的串口助手，或者自己开发一个(暂时有点想法)。目前使用的星瞳串口助手，接收结果如下：

<img src="https://i.loli.net/2020/07/29/daebr3jPEMRShIv.png" alt="结果" style="zoom: 67%;" />

## 总结  

串口助手显示中文乱码的原因有以下几点：

1. 波特率不对应。
2. 字符编码不对应。
3. 串口助手不支持字符编码方式。

## 下面推荐两个串口助手：

1. [星瞳串口助手SingTownSerialport](https://singtown.com/singtownserialport/)（支持Mac，Windows，Ubuntu） 

<img src="https://cdn.singtown.com/2018/09/singtown-serialport-snapshot.png" alt="img" style="zoom: 33%;" />

2. [串口调试助手]([https://www.microsoft.com/zh-cn/p/%e4%b8%b2%e5%8f%a3%e8%b0%83%e8%af%95%e5%8a%a9%e6%89%8b/9nblggh43hdm?rtc=1#activetab=pivot:overviewtab](https://www.microsoft.com/zh-cn/p/串口调试助手/9nblggh43hdm?rtc=1#activetab=pivot:overviewtab))（Windows）

![串口调试助手](https://pic4.zhimg.com/80/v2-b2105cb1777a1c72c83d2bcf287a2ef7_720w.jpg)