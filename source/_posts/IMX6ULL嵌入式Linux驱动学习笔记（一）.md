---
title: IMX6ULL嵌入式Linux驱动学习笔记（一）
date: 2020-09-19 21:29:29
tags: [嵌入式, IMX6ULL, 学习笔记]
keywords:
description: 正点原子alpha开发板IMX6ULL嵌入式Linux开发学习笔记。
---

**IMX6ULL嵌入式Linux驱动开发学习**

以下内容是我在学习正点原子`IMX6ULL`开发板`alpha`中记录的笔记，部分摘录自正点原子`IMX6ULL开发手册`。

## 一、应用程序和驱动的交互原理交互原理

驱动就是获取外设或者传感器数据，控制外设。数据会提交给应用程序。Linux下驱动编写既要编写一个驱动，还要编写一个简单的测试应用程序APP。单片机下驱动和应用都是放到一个文件里面，也就是杂糅到一起。Linux下驱动和应用是完全分开的。

<!--more-->

- 用户空间（用户态）和内核空间（内核态）

  - Linux操作系统内核和驱动程序运行在内核空间，应用程序运行在用户空间，避免应用程序不正确的使用资源对系统产生危害。

  - 应用程序想要访问内核资源有三种办法：系统调用、异常（中断）和陷入（软中断）。应用程序不会直接调用系统调用，而是通过API函数来间接的调用系统调用，比如`POSIX`、`API`和C库等。`unix`类操作系统种最常用的编程接口就是`POSIX`。

  - 系统调用处于内核空间，应用程序无法直接访问，因此需要“陷入”到内核，方法就是软中断，陷入内核以后还要指定系统调用号。（每个系统调用都有一个系统调用号）。

    ![linux应用和驱动交互](https://i.loli.net/2020/09/19/JfkY7L3mF98EhvT.png)

  - 应用程序可以直接使用系统调用函数，比如：`open`、`close`等，也可以使用C库提供的函数。上图的左侧竖线表示直接使用系统调用，右侧竖线表示使用C库里面的函数，而C库里面的函数最终也是调用的系统调用函数。

## 二、嵌入式驱动开发分类

Linux驱动分为3大类：

1. 字符设备驱动，最多的。
2. 块设备驱动，存储。
3. 网络设备驱动。

一个设备不一定只属于某一个类型。比如无线网卡，属于网络设备驱动，因为他又有`USB`和`SDIO`，因此也属于字符设备驱动。

## 三、字符设备驱动开发

- Linux里面一切皆文件，驱动设备表现就是一个`/dev/`目录下的一个文件，比如`/dev/led`文件，应用程序调用`open`函数打开设备，比如led。应用程序通过`write`函数向`/dev/led`写数据，比如写1表示打开，写0代表关闭。如果关闭设备就是调用`close`函数。
- 编写驱动的时候也需要编写驱动对应的`open`、`close`、`read`、`write`函数。字符设备驱动`file_operation`结构体。

1. 驱动最终是被应用调用的，在写驱动的时候要考虑应用开发的便利性。
2. 驱动是分驱动框架的，要按照驱动框架来编写，对于字符设备驱动来说，重点编写应用程序对应的`open`、`close`、`read`、`write`等函数。